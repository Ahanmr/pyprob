;; gorilla-repl.fileformat = 1

;; **
;;; # Minimal example
;; **

;; **
;;; Import the minimum required libraries to run define queries, compile them, and run the inference using compiled artifacts.
;; **

;; @@
(ns minimal
  (:require anglican.csis.csis
            [anglican.csis.network :refer :all]
            [anglican.inference :refer [infer]])
  (:use [anglican emit runtime]
        [gorilla-plot core]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; Define a (non-sensical) query:
;; **

;; @@
(defquery q [observes]
  (let [b (sample "b" (beta 1 1))
        disc (sample "disc" (discrete [1 1 1 1 1]))
        flp (sample "flp" (flip 0.5))
        g (sample "g" (gamma 1 2))
        mvnn (sample "mvnn" (mvn [0 0] [[1 0] [0 1]]))
        n (sample "n" (normal 0 1))
        p (sample "p" (poisson 5))
        u-c (sample "u-c" (uniform-continuous 2.2 5.5))
        u-d (sample "u-d" (uniform-discrete 2 5))]
    (observe (mvn [0 0] [[1 0] [0 1]]) observes)
    b))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/q</span>","value":"#'minimal/q"}
;; <=

;; **
;;; ## Inference Compilation
;; **

;; **
;;; Specify a function `combine-observes-fn` that combines observes from a sample in a form suitable for Torch:
;; **

;; @@
(defn combine-observes-fn [observes]
  (:value (first observes)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/combine-observes-fn</span>","value":"#'minimal/combine-observes-fn"}
;; <=

;; **
;;; In order to write this function, you'll need to look at how a typical `observes` object from your query looks like:
;; **

;; @@
(sample-observes-from-prior q [[1 2]])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:time-index 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:observe-address</span>","value":":observe-address"},{"type":"html","content":"<span class='clj-symbol'>O25705</span>","value":"O25705"}],"value":"[:observe-address O25705]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:number</span>","value":":number"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:number 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.5829390458617159</span>","value":"0.5829390458617159"},{"type":"html","content":"<span class='clj-double'>0.27178122458156523</span>","value":"0.27178122458156523"}],"value":"[0.5829390458617159 0.27178122458156523]"}],"value":"[:value [0.5829390458617159 0.27178122458156523]]"}],"value":"{:time-index 1, :observe-address O25705, :number 1, :value [0.5829390458617159 0.27178122458156523]}"}],"value":"[{:time-index 1, :observe-address O25705, :number 1, :value [0.5829390458617159 0.27178122458156523]}]"}
;; <=

;; **
;;; Now, we can compile our query. First, establish a connection with the Torch side:
;; **

;; @@
(def torch-connection (start-torch-connection q [[1 2]] combine-observes-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/torch-connection</span>","value":"#'minimal/torch-connection"}
;; <=

;; **
;;; Now, run `compile.lua` from the [Torch side](https://github.com/tuananhle7/torch-csis) until you're happy, e.g.:
;;; 
;;; `th compile.lua --batchSize 5 --validSize 5 --validInterval 100 --obsEmbDim 5 --lstmDim 5`
;;; 
;;; When you're happy, you can stop the training by running the following (also, end Torch training via Ctrl-C):
;; **

;; @@
(stop-torch-connection torch-connection)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;Torch connection terminated.&quot;</span>","value":"\"Torch connection terminated.\""}
;; <=

;; **
;;; ## Inference
;; **

;; **
;;; To run inference using the compiled artifact, first run `infer.lua` on the [Torch side](https://github.com/tuananhle7/torch-csis) to start the inference server, e.g.:
;;; 
;;; `th infer.lua --latest`
;;; 
;;; Then run the query, specifying number of particles:
;; **

;; @@
(def num-particles 10)
(def csis-states (take num-particles (infer :csis q [[1 2]])))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/csis-states</span>","value":"#'minimal/csis-states"}
;; <=

;; **
;;; Look at the 10th particle:
;; **

;; @@
(last csis-states)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.state/mem</span>","value":":anglican.state/mem"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[],"value":"{}"}],"value":"[:anglican.state/mem {}]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:predicts</span>","value":":predicts"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[],"value":"[]"}],"value":"[:predicts []]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:result</span>","value":":result"},{"type":"html","content":"<span class='clj-double'>0.7822331466376904</span>","value":"0.7822331466376904"}],"value":"[:result 0.7822331466376904]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:log-weight</span>","value":":log-weight"},{"type":"html","content":"<span class='clj-double'>-9.485643057027048</span>","value":"-9.485643057027048"}],"value":"[:log-weight -9.485643057027048]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.state/store</span>","value":":anglican.state/store"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[:anglican.state/store nil]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.csis.csis/samples</span>","value":":anglican.csis.csis/samples"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""}],"value":"[:sample-address \"b\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.7822331466376904</span>","value":"0.7822331466376904"}],"value":"[:value 0.7822331466376904]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-double'>0.4794879300418624</span>","value":"0.4794879300418624"},{"type":"html","content":"<span class='clj-double'>0.714786819391317</span>","value":"0.714786819391317"}],"value":"[0 1 0.4794879300418624 0.714786819391317]"}],"value":"[:proposal-params [0 1 0.4794879300418624 0.714786819391317]]"}],"value":"{:sample-address \"b\", :sample-instance 1, :value 0.7822331466376904, :proposal-params [0 1 0.4794879300418624 0.714786819391317]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;disc&quot;</span>","value":"\"disc\""}],"value":"[:sample-address \"disc\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[:value 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.004199363392272438</span>","value":"0.004199363392272438"},{"type":"html","content":"<span class='clj-double'>6.476267867966917E-8</span>","value":"6.476267867966917E-8"},{"type":"html","content":"<span class='clj-double'>1.1697202057377258E-6</span>","value":"1.1697202057377258E-6"},{"type":"html","content":"<span class='clj-double'>1.9239724132135914E-5</span>","value":"1.9239724132135914E-5"},{"type":"html","content":"<span class='clj-double'>6.58777468693644E-5</span>","value":"6.58777468693644E-5"}],"value":"(0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)"}],"value":"[0 (0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)]"}],"value":"[:proposal-params [0 (0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)]]"}],"value":"{:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;flp&quot;</span>","value":"\"flp\""}],"value":"[:sample-address \"flp\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-unkown'>true</span>","value":"true"}],"value":"[:value true]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.5404344481978495</span>","value":"0.5404344481978495"}],"value":"(0.5404344481978495)"}],"value":"[:proposal-params (0.5404344481978495)]"}],"value":"{:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5404344481978495)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;g&quot;</span>","value":"\"g\""}],"value":"[:sample-address \"g\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.7240751068897879</span>","value":"0.7240751068897879"}],"value":"[:value 0.7240751068897879]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.9337474286946241</span>","value":"0.9337474286946241"},{"type":"html","content":"<span class='clj-double'>0.8842316622848226</span>","value":"0.8842316622848226"}],"value":"(0.9337474286946241 0.8842316622848226)"}],"value":"[:proposal-params (0.9337474286946241 0.8842316622848226)]"}],"value":"{:sample-address \"g\", :sample-instance 1, :value 0.7240751068897879, :proposal-params (0.9337474286946241 0.8842316622848226)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;mvnn&quot;</span>","value":"\"mvnn\""}],"value":"[:sample-address \"mvnn\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>-2.7325095128105024</span>","value":"-2.7325095128105024"},{"type":"html","content":"<span class='clj-double'>-0.9776090019817043</span>","value":"-0.9776090019817043"}],"value":"[-2.7325095128105024 -0.9776090019817043]"}],"value":"[:value [-2.7325095128105024 -0.9776090019817043]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.10064075610614334</span>","value":"0.10064075610614334"},{"type":"html","content":"<span class='clj-double'>-0.037095516729593936</span>","value":"-0.037095516729593936"}],"value":"[0.10064075610614334 -0.037095516729593936]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.7854142706815095</span>","value":"2.7854142706815095"},{"type":"html","content":"<span class='clj-double'>1.2120920810617208</span>","value":"1.2120920810617208"}],"value":"[2.7854142706815095 1.2120920810617208]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>1.2120920810617208</span>","value":"1.2120920810617208"},{"type":"html","content":"<span class='clj-double'>3.158349917119779</span>","value":"3.158349917119779"}],"value":"[1.2120920810617208 3.158349917119779]"}],"value":"[[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]"}],"value":"[[0.10064075610614334 -0.037095516729593936] [[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]]"}],"value":"[:proposal-params [[0.10064075610614334 -0.037095516729593936] [[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]]]"}],"value":"{:sample-address \"mvnn\", :sample-instance 1, :value [-2.7325095128105024 -0.9776090019817043], :proposal-params [[0.10064075610614334 -0.037095516729593936] [[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;n&quot;</span>","value":"\"n\""}],"value":"[:sample-address \"n\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.9062299818118141</span>","value":"0.9062299818118141"}],"value":"[:value 0.9062299818118141]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.22885169963284868</span>","value":"0.22885169963284868"},{"type":"html","content":"<span class='clj-double'>0.5628192935866408</span>","value":"0.5628192935866408"}],"value":"(0.22885169963284868 0.5628192935866408)"}],"value":"[:proposal-params (0.22885169963284868 0.5628192935866408)]"}],"value":"{:sample-address \"n\", :sample-instance 1, :value 0.9062299818118141, :proposal-params (0.22885169963284868 0.5628192935866408)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;p&quot;</span>","value":"\"p\""}],"value":"[:sample-address \"p\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[:value 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.5953912578547484</span>","value":"3.5953912578547484"},{"type":"html","content":"<span class='clj-double'>2.0034212325220992</span>","value":"2.0034212325220992"}],"value":"(3.5953912578547484 2.0034212325220992)"}],"value":"[:proposal-params (3.5953912578547484 2.0034212325220992)]"}],"value":"{:sample-address \"p\", :sample-instance 1, :value 3, :proposal-params (3.5953912578547484 2.0034212325220992)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;u-c&quot;</span>","value":"\"u-c\""}],"value":"[:sample-address \"u-c\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>2.70690754336605</span>","value":"2.70690754336605"}],"value":"[:value 2.70690754336605]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.2</span>","value":"2.2"},{"type":"html","content":"<span class='clj-double'>5.5</span>","value":"5.5"},{"type":"html","content":"<span class='clj-double'>3.9154652612824776</span>","value":"3.9154652612824776"},{"type":"html","content":"<span class='clj-double'>0.5526535388289983</span>","value":"0.5526535388289983"}],"value":"[2.2 5.5 3.9154652612824776 0.5526535388289983]"}],"value":"[:proposal-params [2.2 5.5 3.9154652612824776 0.5526535388289983]]"}],"value":"{:sample-address \"u-c\", :sample-instance 1, :value 2.70690754336605, :proposal-params [2.2 5.5 3.9154652612824776 0.5526535388289983]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;u-d&quot;</span>","value":"\"u-d\""}],"value":"[:sample-address \"u-d\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"}],"value":"[:value 4]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.997475969583043E-6</span>","value":"3.997475969583043E-6"},{"type":"html","content":"<span class='clj-double'>3.0739354789223537E-4</span>","value":"3.0739354789223537E-4"},{"type":"html","content":"<span class='clj-double'>0.04273200966110951</span>","value":"0.04273200966110951"}],"value":"(3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)"}],"value":"[2 (3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)]"}],"value":"[:proposal-params [2 (3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)]]"}],"value":"{:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)]}"}],"value":"[{:sample-address \"b\", :sample-instance 1, :value 0.7822331466376904, :proposal-params [0 1 0.4794879300418624 0.714786819391317]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5404344481978495)} {:sample-address \"g\", :sample-instance 1, :value 0.7240751068897879, :proposal-params (0.9337474286946241 0.8842316622848226)} {:sample-address \"mvnn\", :sample-instance 1, :value [-2.7325095128105024 -0.9776090019817043], :proposal-params [[0.10064075610614334 -0.037095516729593936] [[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]]} {:sample-address \"n\", :sample-instance 1, :value 0.9062299818118141, :proposal-params (0.22885169963284868 0.5628192935866408)} {:sample-address \"p\", :sample-instance 1, :value 3, :proposal-params (3.5953912578547484 2.0034212325220992)} {:sample-address \"u-c\", :sample-instance 1, :value 2.70690754336605, :proposal-params [2.2 5.5 3.9154652612824776 0.5526535388289983]} {:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)]}]"}],"value":"[:anglican.csis.csis/samples [{:sample-address \"b\", :sample-instance 1, :value 0.7822331466376904, :proposal-params [0 1 0.4794879300418624 0.714786819391317]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5404344481978495)} {:sample-address \"g\", :sample-instance 1, :value 0.7240751068897879, :proposal-params (0.9337474286946241 0.8842316622848226)} {:sample-address \"mvnn\", :sample-instance 1, :value [-2.7325095128105024 -0.9776090019817043], :proposal-params [[0.10064075610614334 -0.037095516729593936] [[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]]} {:sample-address \"n\", :sample-instance 1, :value 0.9062299818118141, :proposal-params (0.22885169963284868 0.5628192935866408)} {:sample-address \"p\", :sample-instance 1, :value 3, :proposal-params (3.5953912578547484 2.0034212325220992)} {:sample-address \"u-c\", :sample-instance 1, :value 2.70690754336605, :proposal-params [2.2 5.5 3.9154652612824776 0.5526535388289983]} {:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)]}]]"}],"value":"{:anglican.state/mem {}, :predicts [], :result 0.7822331466376904, :log-weight -9.485643057027048, :anglican.state/store nil, :anglican.csis.csis/samples [{:sample-address \"b\", :sample-instance 1, :value 0.7822331466376904, :proposal-params [0 1 0.4794879300418624 0.714786819391317]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004199363392272438 6.476267867966917E-8 1.1697202057377258E-6 1.9239724132135914E-5 6.58777468693644E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5404344481978495)} {:sample-address \"g\", :sample-instance 1, :value 0.7240751068897879, :proposal-params (0.9337474286946241 0.8842316622848226)} {:sample-address \"mvnn\", :sample-instance 1, :value [-2.7325095128105024 -0.9776090019817043], :proposal-params [[0.10064075610614334 -0.037095516729593936] [[2.7854142706815095 1.2120920810617208] [1.2120920810617208 3.158349917119779]]]} {:sample-address \"n\", :sample-instance 1, :value 0.9062299818118141, :proposal-params (0.22885169963284868 0.5628192935866408)} {:sample-address \"p\", :sample-instance 1, :value 3, :proposal-params (3.5953912578547484 2.0034212325220992)} {:sample-address \"u-c\", :sample-instance 1, :value 2.70690754336605, :proposal-params [2.2 5.5 3.9154652612824776 0.5526535388289983]} {:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (3.997475969583043E-6 3.0739354789223537E-4 0.04273200966110951)]}]}"}
;; <=

;; @@

;; @@
