;; gorilla-repl.fileformat = 1

;; **
;;; # Minimal example
;; **

;; **
;;; Import the minimum required libraries to run define queries, compile them, and run the inference using compiled artifacts.
;; **

;; @@
(ns minimal
  (:require anglican.csis.csis
            [anglican.csis.network :refer :all]
            [anglican.inference :refer [infer]])
  (:use [anglican emit runtime]
        [gorilla-plot core]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; Define a (non-sensical) query:
;; **

;; @@
(defquery q [observes]
  (let [b (sample "b" (beta 1 1))
        disc (sample "disc" (discrete [1 1 1 1 1]))
        flp (sample "flp" (flip 0.5))
        g (sample "g" (gamma 1 2))
        mvnn (sample "mvnn" (mvn [0 0] [[1 0] [0 1]]))
        n (sample "n" (normal 0 1))
        p (sample "p" (poisson 5))
        u-c (sample "u-c" (uniform-continuous 2.2 5.5))
        u-d (sample "u-d" (uniform-discrete 2 5))]
    (observe (mvn [0 0] [[1 0] [0 1]]) observes)
    b))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/q</span>","value":"#'minimal/q"}
;; <=

;; **
;;; ## Inference Compilation
;; **

;; **
;;; Specify a function `combine-observes-fn` that combines observes from a sample in a form suitable for Torch:
;; **

;; @@
(defn combine-observes-fn [observes]
  (:value (first observes)))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/combine-observes-fn</span>","value":"#'minimal/combine-observes-fn"}
;; <=

;; **
;;; In order to write this function, you'll need to look at how a typical `observes` object from your query looks like:
;; **

;; @@
(sample-observes-from-prior q [[1 2]])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:time-index 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:observe-address</span>","value":":observe-address"},{"type":"html","content":"<span class='clj-symbol'>O25761</span>","value":"O25761"}],"value":"[:observe-address O25761]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:number</span>","value":":number"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:number 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>1.889495730253916</span>","value":"1.889495730253916"},{"type":"html","content":"<span class='clj-double'>-0.5294372097614831</span>","value":"-0.5294372097614831"}],"value":"[1.889495730253916 -0.5294372097614831]"}],"value":"[:value [1.889495730253916 -0.5294372097614831]]"}],"value":"{:time-index 1, :observe-address O25761, :number 1, :value [1.889495730253916 -0.5294372097614831]}"}],"value":"[{:time-index 1, :observe-address O25761, :number 1, :value [1.889495730253916 -0.5294372097614831]}]"}
;; <=

;; **
;;; Now, we can compile our query. First, establish a connection with the Torch side:
;; **

;; @@
(def torch-connection (start-torch-connection q [[1 2]] combine-observes-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/torch-connection</span>","value":"#'minimal/torch-connection"}
;; <=

;; **
;;; Now, run `compile.lua` from the [Torch side](https://github.com/tuananhle7/torch-csis) until you're happy, e.g.:
;;; 
;;; `th compile.lua --batchSize 5 --validSize 5 --validInterval 100 --obsEmbDim 5 --lstmDim 5`
;;; 
;;; When you're happy, you can stop the training by running the following (also, end Torch training via Ctrl-C):
;; **

;; @@
(stop-torch-connection torch-connection)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;Torch connection terminated.&quot;</span>","value":"\"Torch connection terminated.\""}
;; <=

;; **
;;; ## Inference
;; **

;; **
;;; To run inference using the compiled artifact, first run `infer.lua` on the [Torch side](https://github.com/tuananhle7/torch-csis) to start the inference server, e.g.:
;;; 
;;; `th infer.lua --latest`
;;; 
;;; Then run the query, specifying number of particles:
;; **

;; @@
(def num-particles 10)
(def csis-states (take num-particles (infer :csis q [[1 2]])))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/csis-states</span>","value":"#'minimal/csis-states"}
;; <=

;; **
;;; Look at the 10th particle:
;; **

;; @@
(last csis-states)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.state/mem</span>","value":":anglican.state/mem"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[],"value":"{}"}],"value":"[:anglican.state/mem {}]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:predicts</span>","value":":predicts"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[],"value":"[]"}],"value":"[:predicts []]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:result</span>","value":":result"},{"type":"html","content":"<span class='clj-double'>0.17169432614004154</span>","value":"0.17169432614004154"}],"value":"[:result 0.17169432614004154]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:log-weight</span>","value":":log-weight"},{"type":"html","content":"<span class='clj-double'>-11.8689685862553</span>","value":"-11.8689685862553"}],"value":"[:log-weight -11.8689685862553]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.state/store</span>","value":":anglican.state/store"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[:anglican.state/store nil]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.csis.csis/samples</span>","value":":anglican.csis.csis/samples"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""}],"value":"[:sample-address \"b\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.17169432614004154</span>","value":"0.17169432614004154"}],"value":"[:value 0.17169432614004154]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-double'>0.47943113075599897</span>","value":"0.47943113075599897"},{"type":"html","content":"<span class='clj-double'>0.7181595848080297</span>","value":"0.7181595848080297"}],"value":"[0 1 0.47943113075599897 0.7181595848080297]"}],"value":"[:proposal-params [0 1 0.47943113075599897 0.7181595848080297]]"}],"value":"{:sample-address \"b\", :sample-instance 1, :value 0.17169432614004154, :proposal-params [0 1 0.47943113075599897 0.7181595848080297]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;disc&quot;</span>","value":"\"disc\""}],"value":"[:sample-address \"disc\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[:value 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.0046774282419885975</span>","value":"0.0046774282419885975"},{"type":"html","content":"<span class='clj-double'>7.550505584513912E-8</span>","value":"7.550505584513912E-8"},{"type":"html","content":"<span class='clj-double'>8.115391252459475E-7</span>","value":"8.115391252459475E-7"},{"type":"html","content":"<span class='clj-double'>1.7749840889077894E-5</span>","value":"1.7749840889077894E-5"},{"type":"html","content":"<span class='clj-double'>5.489702996583382E-5</span>","value":"5.489702996583382E-5"}],"value":"(0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)"}],"value":"[0 (0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)]"}],"value":"[:proposal-params [0 (0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)]]"}],"value":"{:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;flp&quot;</span>","value":"\"flp\""}],"value":"[:sample-address \"flp\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-unkown'>true</span>","value":"true"}],"value":"[:value true]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.540010645877977</span>","value":"0.540010645877977"}],"value":"(0.540010645877977)"}],"value":"[:proposal-params (0.540010645877977)]"}],"value":"{:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.540010645877977)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;g&quot;</span>","value":"\"g\""}],"value":"[:sample-address \"g\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.1277249335914531</span>","value":"0.1277249335914531"}],"value":"[:value 0.1277249335914531]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.9393537053128732</span>","value":"0.9393537053128732"},{"type":"html","content":"<span class='clj-double'>0.8898432460906247</span>","value":"0.8898432460906247"}],"value":"(0.9393537053128732 0.8898432460906247)"}],"value":"[:proposal-params (0.9393537053128732 0.8898432460906247)]"}],"value":"{:sample-address \"g\", :sample-instance 1, :value 0.1277249335914531, :proposal-params (0.9393537053128732 0.8898432460906247)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;mvnn&quot;</span>","value":"\"mvnn\""}],"value":"[:sample-address \"mvnn\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.06936978536911122</span>","value":"0.06936978536911122"},{"type":"html","content":"<span class='clj-double'>-0.002585832968267976</span>","value":"-0.002585832968267976"}],"value":"[0.06936978536911122 -0.002585832968267976]"}],"value":"[:value [0.06936978536911122 -0.002585832968267976]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.0993628375367066</span>","value":"0.0993628375367066"},{"type":"html","content":"<span class='clj-double'>-0.025283840320690025</span>","value":"-0.025283840320690025"}],"value":"[0.0993628375367066 -0.025283840320690025]"},{"type":"html","content":"<span class='clj-double'>0.001</span>","value":"0.001"}],"value":"[[0.0993628375367066 -0.025283840320690025] 0.001]"}],"value":"[:proposal-params [[0.0993628375367066 -0.025283840320690025] 0.001]]"}],"value":"{:sample-address \"mvnn\", :sample-instance 1, :value [0.06936978536911122 -0.002585832968267976], :proposal-params [[0.0993628375367066 -0.025283840320690025] 0.001]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;n&quot;</span>","value":"\"n\""}],"value":"[:sample-address \"n\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.45224579782146557</span>","value":"0.45224579782146557"}],"value":"[:value 0.45224579782146557]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>-0.12866662473790824</span>","value":"-0.12866662473790824"},{"type":"html","content":"<span class='clj-double'>0.7687280602055754</span>","value":"0.7687280602055754"}],"value":"(-0.12866662473790824 0.7687280602055754)"}],"value":"[:proposal-params (-0.12866662473790824 0.7687280602055754)]"}],"value":"{:sample-address \"n\", :sample-instance 1, :value 0.45224579782146557, :proposal-params (-0.12866662473790824 0.7687280602055754)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;p&quot;</span>","value":"\"p\""}],"value":"[:sample-address \"p\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>5</span>","value":"5"}],"value":"[:value 5]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.617983567532454</span>","value":"2.617983567532454"},{"type":"html","content":"<span class='clj-double'>3.7891014469337274</span>","value":"3.7891014469337274"}],"value":"(2.617983567532454 3.7891014469337274)"}],"value":"[:proposal-params (2.617983567532454 3.7891014469337274)]"}],"value":"{:sample-address \"p\", :sample-instance 1, :value 5, :proposal-params (2.617983567532454 3.7891014469337274)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;u-c&quot;</span>","value":"\"u-c\""}],"value":"[:sample-address \"u-c\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>4.751413010130359</span>","value":"4.751413010130359"}],"value":"[:value 4.751413010130359]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.2</span>","value":"2.2"},{"type":"html","content":"<span class='clj-double'>5.5</span>","value":"5.5"},{"type":"html","content":"<span class='clj-double'>4.175149453033722</span>","value":"4.175149453033722"},{"type":"html","content":"<span class='clj-double'>0.7555861339884625</span>","value":"0.7555861339884625"}],"value":"[2.2 5.5 4.175149453033722 0.7555861339884625]"}],"value":"[:proposal-params [2.2 5.5 4.175149453033722 0.7555861339884625]]"}],"value":"{:sample-address \"u-c\", :sample-instance 1, :value 4.751413010130359, :proposal-params [2.2 5.5 4.175149453033722 0.7555861339884625]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;u-d&quot;</span>","value":"\"u-d\""}],"value":"[:sample-address \"u-d\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>3</span>","value":"3"}],"value":"[:value 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>1.3415913053952576E-7</span>","value":"1.3415913053952576E-7"},{"type":"html","content":"<span class='clj-double'>2.644534741794689E-5</span>","value":"2.644534741794689E-5"},{"type":"html","content":"<span class='clj-double'>5.6164331193982134E-8</span>","value":"5.6164331193982134E-8"}],"value":"(1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)"}],"value":"[2 (1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)]"}],"value":"[:proposal-params [2 (1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)]]"}],"value":"{:sample-address \"u-d\", :sample-instance 1, :value 3, :proposal-params [2 (1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)]}"}],"value":"[{:sample-address \"b\", :sample-instance 1, :value 0.17169432614004154, :proposal-params [0 1 0.47943113075599897 0.7181595848080297]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.540010645877977)} {:sample-address \"g\", :sample-instance 1, :value 0.1277249335914531, :proposal-params (0.9393537053128732 0.8898432460906247)} {:sample-address \"mvnn\", :sample-instance 1, :value [0.06936978536911122 -0.002585832968267976], :proposal-params [[0.0993628375367066 -0.025283840320690025] 0.001]} {:sample-address \"n\", :sample-instance 1, :value 0.45224579782146557, :proposal-params (-0.12866662473790824 0.7687280602055754)} {:sample-address \"p\", :sample-instance 1, :value 5, :proposal-params (2.617983567532454 3.7891014469337274)} {:sample-address \"u-c\", :sample-instance 1, :value 4.751413010130359, :proposal-params [2.2 5.5 4.175149453033722 0.7555861339884625]} {:sample-address \"u-d\", :sample-instance 1, :value 3, :proposal-params [2 (1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)]}]"}],"value":"[:anglican.csis.csis/samples [{:sample-address \"b\", :sample-instance 1, :value 0.17169432614004154, :proposal-params [0 1 0.47943113075599897 0.7181595848080297]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.540010645877977)} {:sample-address \"g\", :sample-instance 1, :value 0.1277249335914531, :proposal-params (0.9393537053128732 0.8898432460906247)} {:sample-address \"mvnn\", :sample-instance 1, :value [0.06936978536911122 -0.002585832968267976], :proposal-params [[0.0993628375367066 -0.025283840320690025] 0.001]} {:sample-address \"n\", :sample-instance 1, :value 0.45224579782146557, :proposal-params (-0.12866662473790824 0.7687280602055754)} {:sample-address \"p\", :sample-instance 1, :value 5, :proposal-params (2.617983567532454 3.7891014469337274)} {:sample-address \"u-c\", :sample-instance 1, :value 4.751413010130359, :proposal-params [2.2 5.5 4.175149453033722 0.7555861339884625]} {:sample-address \"u-d\", :sample-instance 1, :value 3, :proposal-params [2 (1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)]}]]"}],"value":"{:anglican.state/mem {}, :predicts [], :result 0.17169432614004154, :log-weight -11.8689685862553, :anglican.state/store nil, :anglican.csis.csis/samples [{:sample-address \"b\", :sample-instance 1, :value 0.17169432614004154, :proposal-params [0 1 0.47943113075599897 0.7181595848080297]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.0046774282419885975 7.550505584513912E-8 8.115391252459475E-7 1.7749840889077894E-5 5.489702996583382E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.540010645877977)} {:sample-address \"g\", :sample-instance 1, :value 0.1277249335914531, :proposal-params (0.9393537053128732 0.8898432460906247)} {:sample-address \"mvnn\", :sample-instance 1, :value [0.06936978536911122 -0.002585832968267976], :proposal-params [[0.0993628375367066 -0.025283840320690025] 0.001]} {:sample-address \"n\", :sample-instance 1, :value 0.45224579782146557, :proposal-params (-0.12866662473790824 0.7687280602055754)} {:sample-address \"p\", :sample-instance 1, :value 5, :proposal-params (2.617983567532454 3.7891014469337274)} {:sample-address \"u-c\", :sample-instance 1, :value 4.751413010130359, :proposal-params [2.2 5.5 4.175149453033722 0.7555861339884625]} {:sample-address \"u-d\", :sample-instance 1, :value 3, :proposal-params [2 (1.3415913053952576E-7 2.644534741794689E-5 5.6164331193982134E-8)]}]}"}
;; <=

;; @@

;; @@
