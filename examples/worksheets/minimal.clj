;; gorilla-repl.fileformat = 1

;; **
;;; # Minimal example
;; **

;; **
;;; Import the minimum required libraries to run define queries, compile them, and run the inference using compiled artifacts.
;; **

;; @@
(ns minimal
  (:require anglican.csis.csis
            [anglican.csis.network :refer :all]
            [anglican.inference :refer [infer]])
  (:use [anglican emit runtime]
        [gorilla-plot core]))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; **
;;; Define a (non-sensical) query:
;; **

;; @@
(defquery q [observes]
  (let [b (sample "b" (beta 1 1))
        disc (sample "disc" (discrete [1 1 1 1 1]))
        flp (sample "flp" (flip 0.5))
        g (sample "g" (gamma 1 2))
        mvnn (sample "mvnn" (mvn [0 0] [[1 0] [0 1]]))
        n (sample "n" (normal 0 1))
        p (sample "p" (poisson 5))
        u-c (sample "u-c" (uniform-continuous 2.2 5.5))
        u-d (sample "u-d" (uniform-discrete 2 5))]
    (observe (mvn [0 0] [[1 0] [0 1]]) observes)
    b))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/q</span>","value":"#'minimal/q"}
;; <=

;; **
;;; ## Inference Compilation
;; **

;; **
;;; Specify a function `combine-observes-fn` that combines observes from a sample in a form suitable for Torch:
;; **

;; @@
(defn combine-observes-fn [observes]
  (let [data (:value (first observes))
        dim (count data)]
    {"shape" [dim] "data" data}))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/combine-observes-fn</span>","value":"#'minimal/combine-observes-fn"}
;; <=

;; **
;;; In order to write this function, you'll need to look at how a typical `observes` object from your query looks like:
;; **

;; @@
(sample-observes-from-prior q [[1 2]])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:time-index 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:observe-address</span>","value":":observe-address"},{"type":"html","content":"<span class='clj-symbol'>O25701</span>","value":"O25701"}],"value":"[:observe-address O25701]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:number</span>","value":":number"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:number 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>-0.058122083861723454</span>","value":"-0.058122083861723454"},{"type":"html","content":"<span class='clj-double'>0.7379469018058303</span>","value":"0.7379469018058303"}],"value":"[-0.058122083861723454 0.7379469018058303]"}],"value":"[:value [-0.058122083861723454 0.7379469018058303]]"}],"value":"{:time-index 1, :observe-address O25701, :number 1, :value [-0.058122083861723454 0.7379469018058303]}"}],"value":"[{:time-index 1, :observe-address O25701, :number 1, :value [-0.058122083861723454 0.7379469018058303]}]"}
;; <=

;; **
;;; Now, we can compile our query. First, establish a connection with the Torch side:
;; **

;; @@
(def torch-connection (start-torch-connection q [[1 2]] combine-observes-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/torch-connection</span>","value":"#'minimal/torch-connection"}
;; <=

;; **
;;; Now, run `compile.lua` from the [Torch side](https://github.com/tuananhle7/torch-csis) until you're happy, e.g.:
;;; 
;;; `th compile.lua --batchSize 5 --validSize 5 --validInterval 100 --obsEmbDim 5 --lstmDim 5`
;;; 
;;; When you're happy, you can stop the training by running the following (also, end Torch training via Ctrl-C):
;; **

;; @@
(stop-torch-connection torch-connection)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;Torch connection terminated.&quot;</span>","value":"\"Torch connection terminated.\""}
;; <=

;; **
;;; ## Inference
;; **

;; **
;;; To run inference using the compiled artifact, first run `infer.lua` on the [Torch side](https://github.com/tuananhle7/torch-csis) to start the inference server, e.g.:
;;; 
;;; `th infer.lua --latest`
;;; 
;;; Then run the query, specifying number of particles:
;; **

;; @@
(def num-particles 10)
(def csis-states (take num-particles (infer :csis q [[1 2]])))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;minimal/csis-states</span>","value":"#'minimal/csis-states"}
;; <=

;; **
;;; Look at the 10th particle:
;; **

;; @@
(last csis-states)
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.state/mem</span>","value":":anglican.state/mem"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[],"value":"{}"}],"value":"[:anglican.state/mem {}]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:predicts</span>","value":":predicts"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[],"value":"[]"}],"value":"[:predicts []]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:result</span>","value":":result"},{"type":"html","content":"<span class='clj-double'>0.9420098008650398</span>","value":"0.9420098008650398"}],"value":"[:result 0.9420098008650398]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:log-weight</span>","value":":log-weight"},{"type":"html","content":"<span class='clj-double'>-9.028343134944674</span>","value":"-9.028343134944674"}],"value":"[:log-weight -9.028343134944674]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.state/store</span>","value":":anglican.state/store"},{"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}],"value":"[:anglican.state/store nil]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:anglican.csis.csis/samples</span>","value":":anglican.csis.csis/samples"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;b&quot;</span>","value":"\"b\""}],"value":"[:sample-address \"b\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.9420098008650398</span>","value":"0.9420098008650398"}],"value":"[:value 0.9420098008650398]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"},{"type":"html","content":"<span class='clj-double'>0.4789497484218986</span>","value":"0.4789497484218986"},{"type":"html","content":"<span class='clj-double'>0.717791577081912</span>","value":"0.717791577081912"}],"value":"[0 1 0.4789497484218986 0.717791577081912]"}],"value":"[:proposal-params [0 1 0.4789497484218986 0.717791577081912]]"}],"value":"{:sample-address \"b\", :sample-instance 1, :value 0.9420098008650398, :proposal-params [0 1 0.4789497484218986 0.717791577081912]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;disc&quot;</span>","value":"\"disc\""}],"value":"[:sample-address \"disc\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"}],"value":"[:value 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>0</span>","value":"0"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.004564190678461566</span>","value":"0.004564190678461566"},{"type":"html","content":"<span class='clj-double'>6.207402323384438E-8</span>","value":"6.207402323384438E-8"},{"type":"html","content":"<span class='clj-double'>8.150915574262238E-7</span>","value":"8.150915574262238E-7"},{"type":"html","content":"<span class='clj-double'>1.4745747988117835E-5</span>","value":"1.4745747988117835E-5"},{"type":"html","content":"<span class='clj-double'>5.375745166319819E-5</span>","value":"5.375745166319819E-5"}],"value":"(0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)"}],"value":"[0 (0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)]"}],"value":"[:proposal-params [0 (0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)]]"}],"value":"{:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;flp&quot;</span>","value":"\"flp\""}],"value":"[:sample-address \"flp\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-unkown'>true</span>","value":"true"}],"value":"[:value true]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.5390882365567884</span>","value":"0.5390882365567884"}],"value":"(0.5390882365567884)"}],"value":"[:proposal-params (0.5390882365567884)]"}],"value":"{:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5390882365567884)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;g&quot;</span>","value":"\"g\""}],"value":"[:sample-address \"g\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>1.4671926185935185</span>","value":"1.4671926185935185"}],"value":"[:value 1.4671926185935185]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.9383858167830429</span>","value":"0.9383858167830429"},{"type":"html","content":"<span class='clj-double'>0.8884907648976399</span>","value":"0.8884907648976399"}],"value":"(0.9383858167830429 0.8884907648976399)"}],"value":"[:proposal-params (0.9383858167830429 0.8884907648976399)]"}],"value":"{:sample-address \"g\", :sample-instance 1, :value 1.4671926185935185, :proposal-params (0.9383858167830429 0.8884907648976399)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;mvnn&quot;</span>","value":"\"mvnn\""}],"value":"[:sample-address \"mvnn\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>-1.535777366513292</span>","value":"-1.535777366513292"},{"type":"html","content":"<span class='clj-double'>0.7535435482385435</span>","value":"0.7535435482385435"}],"value":"[-1.535777366513292 0.7535435482385435]"}],"value":"[:value [-1.535777366513292 0.7535435482385435]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.10224485410719755</span>","value":"0.10224485410719755"},{"type":"html","content":"<span class='clj-double'>-0.031144047761492277</span>","value":"-0.031144047761492277"}],"value":"[0.10224485410719755 -0.031144047761492277]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.7812418951951043</span>","value":"2.7812418951951043"},{"type":"html","content":"<span class='clj-double'>1.2127177780999867</span>","value":"1.2127177780999867"}],"value":"[2.7812418951951043 1.2127177780999867]"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>1.2127177780999867</span>","value":"1.2127177780999867"},{"type":"html","content":"<span class='clj-double'>3.1602293989273074</span>","value":"3.1602293989273074"}],"value":"[1.2127177780999867 3.1602293989273074]"}],"value":"[[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]"}],"value":"[[0.10224485410719755 -0.031144047761492277] [[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]]"}],"value":"[:proposal-params [[0.10224485410719755 -0.031144047761492277] [[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]]]"}],"value":"{:sample-address \"mvnn\", :sample-instance 1, :value [-1.535777366513292 0.7535435482385435], :proposal-params [[0.10224485410719755 -0.031144047761492277] [[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;n&quot;</span>","value":"\"n\""}],"value":"[:sample-address \"n\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>-0.2635419168418415</span>","value":"-0.2635419168418415"}],"value":"[:value -0.2635419168418415]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>0.23380063791724184</span>","value":"0.23380063791724184"},{"type":"html","content":"<span class='clj-double'>0.5648432701792584</span>","value":"0.5648432701792584"}],"value":"(0.23380063791724184 0.5648432701792584)"}],"value":"[:proposal-params (0.23380063791724184 0.5648432701792584)]"}],"value":"{:sample-address \"n\", :sample-instance 1, :value -0.2635419168418415, :proposal-params (0.23380063791724184 0.5648432701792584)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;p&quot;</span>","value":"\"p\""}],"value":"[:sample-address \"p\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:value 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>3.5813534276652352</span>","value":"3.5813534276652352"},{"type":"html","content":"<span class='clj-double'>1.9996072751158114</span>","value":"1.9996072751158114"}],"value":"(3.5813534276652352 1.9996072751158114)"}],"value":"[:proposal-params (3.5813534276652352 1.9996072751158114)]"}],"value":"{:sample-address \"p\", :sample-instance 1, :value 1, :proposal-params (3.5813534276652352 1.9996072751158114)}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;u-c&quot;</span>","value":"\"u-c\""}],"value":"[:sample-address \"u-c\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>3.8803519064644103</span>","value":"3.8803519064644103"}],"value":"[:value 3.8803519064644103]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.2</span>","value":"2.2"},{"type":"html","content":"<span class='clj-double'>5.5</span>","value":"5.5"},{"type":"html","content":"<span class='clj-double'>3.9218441930774555</span>","value":"3.9218441930774555"},{"type":"html","content":"<span class='clj-double'>0.5611544430414833</span>","value":"0.5611544430414833"}],"value":"[2.2 5.5 3.9218441930774555 0.5611544430414833]"}],"value":"[:proposal-params [2.2 5.5 3.9218441930774555 0.5611544430414833]]"}],"value":"{:sample-address \"u-c\", :sample-instance 1, :value 3.8803519064644103, :proposal-params [2.2 5.5 3.9218441930774555 0.5611544430414833]}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;u-d&quot;</span>","value":"\"u-d\""}],"value":"[:sample-address \"u-d\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-long'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-long'>4</span>","value":"4"}],"value":"[:value 4]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:proposal-params</span>","value":":proposal-params"},{"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-long'>2</span>","value":"2"},{"type":"list-like","open":"<span class='clj-lazy-seq'>(</span>","close":"<span class='clj-lazy-seq'>)</span>","separator":" ","items":[{"type":"html","content":"<span class='clj-double'>2.380472495962919E-6</span>","value":"2.380472495962919E-6"},{"type":"html","content":"<span class='clj-double'>2.4371564842898038E-4</span>","value":"2.4371564842898038E-4"},{"type":"html","content":"<span class='clj-double'>0.04984776322973015</span>","value":"0.04984776322973015"}],"value":"(2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)"}],"value":"[2 (2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)]"}],"value":"[:proposal-params [2 (2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)]]"}],"value":"{:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)]}"}],"value":"[{:sample-address \"b\", :sample-instance 1, :value 0.9420098008650398, :proposal-params [0 1 0.4789497484218986 0.717791577081912]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5390882365567884)} {:sample-address \"g\", :sample-instance 1, :value 1.4671926185935185, :proposal-params (0.9383858167830429 0.8884907648976399)} {:sample-address \"mvnn\", :sample-instance 1, :value [-1.535777366513292 0.7535435482385435], :proposal-params [[0.10224485410719755 -0.031144047761492277] [[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]]} {:sample-address \"n\", :sample-instance 1, :value -0.2635419168418415, :proposal-params (0.23380063791724184 0.5648432701792584)} {:sample-address \"p\", :sample-instance 1, :value 1, :proposal-params (3.5813534276652352 1.9996072751158114)} {:sample-address \"u-c\", :sample-instance 1, :value 3.8803519064644103, :proposal-params [2.2 5.5 3.9218441930774555 0.5611544430414833]} {:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)]}]"}],"value":"[:anglican.csis.csis/samples [{:sample-address \"b\", :sample-instance 1, :value 0.9420098008650398, :proposal-params [0 1 0.4789497484218986 0.717791577081912]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5390882365567884)} {:sample-address \"g\", :sample-instance 1, :value 1.4671926185935185, :proposal-params (0.9383858167830429 0.8884907648976399)} {:sample-address \"mvnn\", :sample-instance 1, :value [-1.535777366513292 0.7535435482385435], :proposal-params [[0.10224485410719755 -0.031144047761492277] [[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]]} {:sample-address \"n\", :sample-instance 1, :value -0.2635419168418415, :proposal-params (0.23380063791724184 0.5648432701792584)} {:sample-address \"p\", :sample-instance 1, :value 1, :proposal-params (3.5813534276652352 1.9996072751158114)} {:sample-address \"u-c\", :sample-instance 1, :value 3.8803519064644103, :proposal-params [2.2 5.5 3.9218441930774555 0.5611544430414833]} {:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)]}]]"}],"value":"{:anglican.state/mem {}, :predicts [], :result 0.9420098008650398, :log-weight -9.028343134944674, :anglican.state/store nil, :anglican.csis.csis/samples [{:sample-address \"b\", :sample-instance 1, :value 0.9420098008650398, :proposal-params [0 1 0.4789497484218986 0.717791577081912]} {:sample-address \"disc\", :sample-instance 1, :value 0, :proposal-params [0 (0.004564190678461566 6.207402323384438E-8 8.150915574262238E-7 1.4745747988117835E-5 5.375745166319819E-5)]} {:sample-address \"flp\", :sample-instance 1, :value true, :proposal-params (0.5390882365567884)} {:sample-address \"g\", :sample-instance 1, :value 1.4671926185935185, :proposal-params (0.9383858167830429 0.8884907648976399)} {:sample-address \"mvnn\", :sample-instance 1, :value [-1.535777366513292 0.7535435482385435], :proposal-params [[0.10224485410719755 -0.031144047761492277] [[2.7812418951951043 1.2127177780999867] [1.2127177780999867 3.1602293989273074]]]} {:sample-address \"n\", :sample-instance 1, :value -0.2635419168418415, :proposal-params (0.23380063791724184 0.5648432701792584)} {:sample-address \"p\", :sample-instance 1, :value 1, :proposal-params (3.5813534276652352 1.9996072751158114)} {:sample-address \"u-c\", :sample-instance 1, :value 3.8803519064644103, :proposal-params [2.2 5.5 3.9218441930774555 0.5611544430414833]} {:sample-address \"u-d\", :sample-instance 1, :value 4, :proposal-params [2 (2.380472495962919E-6 2.4371564842898038E-4 0.04984776322973015)]}]}"}
;; <=

;; @@

;; @@
