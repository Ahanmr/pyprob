;; gorilla-repl.fileformat = 1

;; **
;;; # Dirichlet Process Mixture Model - stick breaking construction
;; **

;; @@
(ns worksheets.dirichlet-process-mixture-stick-breaking
  (:require [anglican.runtime :refer :all]
            [anglican.emit :refer [defquery with-primitive-procedures defm]]
            [anglican.stat :refer [empirical-distribution collect-predicts collect-by collect-results]]
            [anglican.core :refer [doquery]]
            [anglican.state :refer [get-predicts]]
            anglican.infcomp.csis
            anglican.importance
            anglican.smc
            anglican.pgibbs
            anglican.infcomp.core
            [anglican.infcomp.dists :refer :all]
            [anglican.infcomp.network :refer :all]
            [anglican.infcomp.prior :refer :all]
            [anglican.inference :refer [infer]]
            [gorilla-plot.core :as plot]))

(anglican.infcomp.core/reset-infcomp-addressing-scheme!)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-unkown'>#function[anglican.infcomp.core/reset-infcomp-addressing-scheme!$fn--27378$fn--27379]</span>","value":"#function[anglican.infcomp.core/reset-infcomp-addressing-scheme!$fn--27378$fn--27379]"}
;; <=

;; @@
(defm create-sethuraman-stick-breaking-process
  [concentration]
  (let
    [
      ; sethuraman-stick-breaking-rule returns 
      ; a stick length via the one-parameter 
      ; stick breaking rule which closes
      ; over concentration
      sethuraman-stick-breaking-rule 
      (mem (fn [k] (sample* (beta 1 concentration))))

      ; sample-stick-index is a procedure that 
      ; samples an index from a potentially 
      ; infinite dimensional discrete distribution 
      ; lazily constructed by a stick breaking rule
      sample-stick-index 
      (fn sample-stick-index [k] 
        (if (sample* (flip (sethuraman-stick-breaking-rule k))) 
          k 
          (sample-stick-index (+ k 1))))

      ; wrapping a stick breaking process to return it
      stick-breaking-process 
      (fn [] (sample-stick-index 1))]
    stick-breaking-process))

(defm DPmem
  "DPmem is a procedure that takes two arguments -- 
  the concentration to a Dirichlet process
  and a base sampling procedure. DPmem returns a procedure."
  [concentration base]
  (let [get-value-from-cache-or-sample 
        (mem 
          (fn [args stick-index] 
            (apply base args)))
        get-stick-picking-procedure-from-cache 
        (mem 
          (fn [args] 
            (create-sethuraman-stick-breaking-process 
              concentration)))]
    (fn [& varargs]
      ; when the returned function is called, 
      ; the first thing it does is get
      ; the cached stick breaking procedure 
      ; for the passed in arguments
      ; and _calls_ it to get an index
      (let [index ((get-stick-picking-procedure-from-cache 
                     varargs))]
        ; if, for the given set of arguments 
        ; and just sampled index a return value has already 
        ; been computed, get it from the cache
        ; and return it, otherwise sample a new value
        (get-value-from-cache-or-sample varargs index)))))

(defquery dirichlet-process-mixture-stick-breaking
  [input-data]
  (let
    [concentration 10
     base (fn []
            (let [v (/ 1.0 (sample (gamma 1 0.1)))]
              (list (sample (normal 0 (sqrt (* v 30)))) 
                    (sqrt v))))
     obs-param (DPmem concentration base)]

    ; observe draws from the DP mixture
    (map
      (fn [value]
        (observe (apply normal (obs-param)) value))
      input-data)

    ; predict a data point from the DP mixture
    (sample (apply normal (obs-param)))))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.dirichlet-process-mixture-stick-breaking/dirichlet-process-mixture-stick-breaking</span>","value":"#'worksheets.dirichlet-process-mixture-stick-breaking/dirichlet-process-mixture-stick-breaking"}
;; <=

;; **
;;; ## Inference compilation
;;; 
;;; Specify a function `combine-observes-fn` that combines observes from a sample in a form suitable for Torch:
;; **

;; @@
(sample-samples-from-prior dirichlet-process-mixture-stick-breaking [(repeat 8 nil)])
;; @@
;; =>
;;; {"type":"list-like","open":"<span class='clj-vector'>[</span>","close":"<span class='clj-vector'>]</span>","separator":" ","items":[{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>0</span>","value":"0"}],"value":"[:time-index 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S65&quot;</span>","value":"\"S65\""}],"value":"[:sample-address \"S65\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>0</span>","value":"0"}],"value":"[:sample-instance 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0xdb12dd2 &quot;anglican.infcomp.flatbuffers.gamma.GammaClj@db12dd2&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0xdb12dd2 \"anglican.infcomp.flatbuffers.gamma.GammaClj@db12dd2\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0xdb12dd2 \"anglican.infcomp.flatbuffers.gamma.GammaClj@db12dd2\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.8476691787003959</span>","value":"0.8476691787003959"}],"value":"[:value 0.8476691787003959]"}],"value":"{:time-index 0, :sample-address \"S65\", :sample-instance 0, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0xdb12dd2 \"anglican.infcomp.flatbuffers.gamma.GammaClj@db12dd2\"], :value 0.8476691787003959}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>1</span>","value":"1"}],"value":"[:time-index 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S61&quot;</span>","value":"\"S61\""}],"value":"[:sample-address \"S61\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>0</span>","value":"0"}],"value":"[:sample-instance 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1ad94224 &quot;anglican.infcomp.flatbuffers.normal.NormalClj@1ad94224&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1ad94224 \"anglican.infcomp.flatbuffers.normal.NormalClj@1ad94224\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1ad94224 \"anglican.infcomp.flatbuffers.normal.NormalClj@1ad94224\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>-2.1580974054483963</span>","value":"-2.1580974054483963"}],"value":"[:value -2.1580974054483963]"}],"value":"{:time-index 1, :sample-address \"S61\", :sample-instance 0, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1ad94224 \"anglican.infcomp.flatbuffers.normal.NormalClj@1ad94224\"], :value -2.1580974054483963}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>2</span>","value":"2"}],"value":"[:time-index 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S65&quot;</span>","value":"\"S65\""}],"value":"[:sample-address \"S65\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x58bc6089 &quot;anglican.infcomp.flatbuffers.gamma.GammaClj@58bc6089&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x58bc6089 \"anglican.infcomp.flatbuffers.gamma.GammaClj@58bc6089\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x58bc6089 \"anglican.infcomp.flatbuffers.gamma.GammaClj@58bc6089\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>9.707467147495931</span>","value":"9.707467147495931"}],"value":"[:value 9.707467147495931]"}],"value":"{:time-index 2, :sample-address \"S65\", :sample-instance 1, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x58bc6089 \"anglican.infcomp.flatbuffers.gamma.GammaClj@58bc6089\"], :value 9.707467147495931}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>3</span>","value":"3"}],"value":"[:time-index 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S61&quot;</span>","value":"\"S61\""}],"value":"[:sample-address \"S61\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>1</span>","value":"1"}],"value":"[:sample-instance 1]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1f4655bf &quot;anglican.infcomp.flatbuffers.normal.NormalClj@1f4655bf&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1f4655bf \"anglican.infcomp.flatbuffers.normal.NormalClj@1f4655bf\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1f4655bf \"anglican.infcomp.flatbuffers.normal.NormalClj@1f4655bf\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>3.1349892904629906</span>","value":"3.1349892904629906"}],"value":"[:value 3.1349892904629906]"}],"value":"{:time-index 3, :sample-address \"S61\", :sample-instance 1, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1f4655bf \"anglican.infcomp.flatbuffers.normal.NormalClj@1f4655bf\"], :value 3.1349892904629906}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>4</span>","value":"4"}],"value":"[:time-index 4]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S65&quot;</span>","value":"\"S65\""}],"value":"[:sample-address \"S65\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>2</span>","value":"2"}],"value":"[:sample-instance 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x1b9d3438 &quot;anglican.infcomp.flatbuffers.gamma.GammaClj@1b9d3438&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x1b9d3438 \"anglican.infcomp.flatbuffers.gamma.GammaClj@1b9d3438\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x1b9d3438 \"anglican.infcomp.flatbuffers.gamma.GammaClj@1b9d3438\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.4043576392769158</span>","value":"0.4043576392769158"}],"value":"[:value 0.4043576392769158]"}],"value":"{:time-index 4, :sample-address \"S65\", :sample-instance 2, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x1b9d3438 \"anglican.infcomp.flatbuffers.gamma.GammaClj@1b9d3438\"], :value 0.4043576392769158}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>5</span>","value":"5"}],"value":"[:time-index 5]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S61&quot;</span>","value":"\"S61\""}],"value":"[:sample-address \"S61\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>2</span>","value":"2"}],"value":"[:sample-instance 2]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x4b859d0d &quot;anglican.infcomp.flatbuffers.normal.NormalClj@4b859d0d&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x4b859d0d \"anglican.infcomp.flatbuffers.normal.NormalClj@4b859d0d\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x4b859d0d \"anglican.infcomp.flatbuffers.normal.NormalClj@4b859d0d\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>10.084456609898497</span>","value":"10.084456609898497"}],"value":"[:value 10.084456609898497]"}],"value":"{:time-index 5, :sample-address \"S61\", :sample-instance 2, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x4b859d0d \"anglican.infcomp.flatbuffers.normal.NormalClj@4b859d0d\"], :value 10.084456609898497}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>6</span>","value":"6"}],"value":"[:time-index 6]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S65&quot;</span>","value":"\"S65\""}],"value":"[:sample-address \"S65\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>3</span>","value":"3"}],"value":"[:sample-instance 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x700614dc &quot;anglican.infcomp.flatbuffers.gamma.GammaClj@700614dc&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x700614dc \"anglican.infcomp.flatbuffers.gamma.GammaClj@700614dc\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x700614dc \"anglican.infcomp.flatbuffers.gamma.GammaClj@700614dc\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>5.509213129856523</span>","value":"5.509213129856523"}],"value":"[:value 5.509213129856523]"}],"value":"{:time-index 6, :sample-address \"S65\", :sample-instance 3, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x700614dc \"anglican.infcomp.flatbuffers.gamma.GammaClj@700614dc\"], :value 5.509213129856523}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>7</span>","value":"7"}],"value":"[:time-index 7]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S61&quot;</span>","value":"\"S61\""}],"value":"[:sample-address \"S61\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>3</span>","value":"3"}],"value":"[:sample-instance 3]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x5dc04cce &quot;anglican.infcomp.flatbuffers.normal.NormalClj@5dc04cce&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x5dc04cce \"anglican.infcomp.flatbuffers.normal.NormalClj@5dc04cce\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x5dc04cce \"anglican.infcomp.flatbuffers.normal.NormalClj@5dc04cce\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>-0.04207217735247731</span>","value":"-0.04207217735247731"}],"value":"[:value -0.04207217735247731]"}],"value":"{:time-index 7, :sample-address \"S61\", :sample-instance 3, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x5dc04cce \"anglican.infcomp.flatbuffers.normal.NormalClj@5dc04cce\"], :value -0.04207217735247731}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>8</span>","value":"8"}],"value":"[:time-index 8]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S65&quot;</span>","value":"\"S65\""}],"value":"[:sample-address \"S65\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>4</span>","value":"4"}],"value":"[:sample-instance 4]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x2f0e9fba &quot;anglican.infcomp.flatbuffers.gamma.GammaClj@2f0e9fba&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x2f0e9fba \"anglican.infcomp.flatbuffers.gamma.GammaClj@2f0e9fba\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x2f0e9fba \"anglican.infcomp.flatbuffers.gamma.GammaClj@2f0e9fba\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>8.633091890679685</span>","value":"8.633091890679685"}],"value":"[:value 8.633091890679685]"}],"value":"{:time-index 8, :sample-address \"S65\", :sample-instance 4, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x2f0e9fba \"anglican.infcomp.flatbuffers.gamma.GammaClj@2f0e9fba\"], :value 8.633091890679685}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>9</span>","value":"9"}],"value":"[:time-index 9]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S61&quot;</span>","value":"\"S61\""}],"value":"[:sample-address \"S61\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>4</span>","value":"4"}],"value":"[:sample-instance 4]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x488402a3 &quot;anglican.infcomp.flatbuffers.normal.NormalClj@488402a3&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x488402a3 \"anglican.infcomp.flatbuffers.normal.NormalClj@488402a3\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x488402a3 \"anglican.infcomp.flatbuffers.normal.NormalClj@488402a3\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>0.9645215115130794</span>","value":"0.9645215115130794"}],"value":"[:value 0.9645215115130794]"}],"value":"{:time-index 9, :sample-address \"S61\", :sample-instance 4, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x488402a3 \"anglican.infcomp.flatbuffers.normal.NormalClj@488402a3\"], :value 0.9645215115130794}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>10</span>","value":"10"}],"value":"[:time-index 10]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S65&quot;</span>","value":"\"S65\""}],"value":"[:sample-address \"S65\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>5</span>","value":"5"}],"value":"[:sample-instance 5]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x8e44f9b &quot;anglican.infcomp.flatbuffers.gamma.GammaClj@8e44f9b&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x8e44f9b \"anglican.infcomp.flatbuffers.gamma.GammaClj@8e44f9b\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x8e44f9b \"anglican.infcomp.flatbuffers.gamma.GammaClj@8e44f9b\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>24.19496878216539</span>","value":"24.19496878216539"}],"value":"[:value 24.19496878216539]"}],"value":"{:time-index 10, :sample-address \"S65\", :sample-instance 5, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x8e44f9b \"anglican.infcomp.flatbuffers.gamma.GammaClj@8e44f9b\"], :value 24.19496878216539}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>11</span>","value":"11"}],"value":"[:time-index 11]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S61&quot;</span>","value":"\"S61\""}],"value":"[:sample-address \"S61\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>5</span>","value":"5"}],"value":"[:sample-instance 5]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x579dd475 &quot;anglican.infcomp.flatbuffers.normal.NormalClj@579dd475&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0x579dd475 \"anglican.infcomp.flatbuffers.normal.NormalClj@579dd475\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x579dd475 \"anglican.infcomp.flatbuffers.normal.NormalClj@579dd475\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>1.3423959685903382</span>","value":"1.3423959685903382"}],"value":"[:value 1.3423959685903382]"}],"value":"{:time-index 11, :sample-address \"S61\", :sample-instance 5, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x579dd475 \"anglican.infcomp.flatbuffers.normal.NormalClj@579dd475\"], :value 1.3423959685903382}"},{"type":"list-like","open":"<span class='clj-map'>{</span>","close":"<span class='clj-map'>}</span>","separator":", ","items":[{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:time-index</span>","value":":time-index"},{"type":"html","content":"<span class='clj-unkown'>12</span>","value":"12"}],"value":"[:time-index 12]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-address</span>","value":":sample-address"},{"type":"html","content":"<span class='clj-string'>&quot;S46&quot;</span>","value":"\"S46\""}],"value":"[:sample-address \"S46\"]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:sample-instance</span>","value":":sample-instance"},{"type":"html","content":"<span class='clj-unkown'>0</span>","value":"0"}],"value":"[:sample-instance 0]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:distribution</span>","value":":distribution"},{"type":"html","content":"<span class='clj-unkown'>#object[anglican.infcomp.flatbuffers.normal.NormalClj 0xc357273 &quot;anglican.infcomp.flatbuffers.normal.NormalClj@c357273&quot;]</span>","value":"#object[anglican.infcomp.flatbuffers.normal.NormalClj 0xc357273 \"anglican.infcomp.flatbuffers.normal.NormalClj@c357273\"]"}],"value":"[:distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0xc357273 \"anglican.infcomp.flatbuffers.normal.NormalClj@c357273\"]]"},{"type":"list-like","open":"","close":"","separator":" ","items":[{"type":"html","content":"<span class='clj-keyword'>:value</span>","value":":value"},{"type":"html","content":"<span class='clj-double'>1.4112123648126922</span>","value":"1.4112123648126922"}],"value":"[:value 1.4112123648126922]"}],"value":"{:time-index 12, :sample-address \"S46\", :sample-instance 0, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0xc357273 \"anglican.infcomp.flatbuffers.normal.NormalClj@c357273\"], :value 1.4112123648126922}"}],"value":"[{:time-index 0, :sample-address \"S65\", :sample-instance 0, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0xdb12dd2 \"anglican.infcomp.flatbuffers.gamma.GammaClj@db12dd2\"], :value 0.8476691787003959} {:time-index 1, :sample-address \"S61\", :sample-instance 0, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1ad94224 \"anglican.infcomp.flatbuffers.normal.NormalClj@1ad94224\"], :value -2.1580974054483963} {:time-index 2, :sample-address \"S65\", :sample-instance 1, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x58bc6089 \"anglican.infcomp.flatbuffers.gamma.GammaClj@58bc6089\"], :value 9.707467147495931} {:time-index 3, :sample-address \"S61\", :sample-instance 1, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x1f4655bf \"anglican.infcomp.flatbuffers.normal.NormalClj@1f4655bf\"], :value 3.1349892904629906} {:time-index 4, :sample-address \"S65\", :sample-instance 2, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x1b9d3438 \"anglican.infcomp.flatbuffers.gamma.GammaClj@1b9d3438\"], :value 0.4043576392769158} {:time-index 5, :sample-address \"S61\", :sample-instance 2, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x4b859d0d \"anglican.infcomp.flatbuffers.normal.NormalClj@4b859d0d\"], :value 10.084456609898497} {:time-index 6, :sample-address \"S65\", :sample-instance 3, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x700614dc \"anglican.infcomp.flatbuffers.gamma.GammaClj@700614dc\"], :value 5.509213129856523} {:time-index 7, :sample-address \"S61\", :sample-instance 3, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x5dc04cce \"anglican.infcomp.flatbuffers.normal.NormalClj@5dc04cce\"], :value -0.04207217735247731} {:time-index 8, :sample-address \"S65\", :sample-instance 4, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x2f0e9fba \"anglican.infcomp.flatbuffers.gamma.GammaClj@2f0e9fba\"], :value 8.633091890679685} {:time-index 9, :sample-address \"S61\", :sample-instance 4, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x488402a3 \"anglican.infcomp.flatbuffers.normal.NormalClj@488402a3\"], :value 0.9645215115130794} {:time-index 10, :sample-address \"S65\", :sample-instance 5, :distribution #object[anglican.infcomp.flatbuffers.gamma.GammaClj 0x8e44f9b \"anglican.infcomp.flatbuffers.gamma.GammaClj@8e44f9b\"], :value 24.19496878216539} {:time-index 11, :sample-address \"S61\", :sample-instance 5, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0x579dd475 \"anglican.infcomp.flatbuffers.normal.NormalClj@579dd475\"], :value 1.3423959685903382} {:time-index 12, :sample-address \"S46\", :sample-instance 0, :distribution #object[anglican.infcomp.flatbuffers.normal.NormalClj 0xc357273 \"anglican.infcomp.flatbuffers.normal.NormalClj@c357273\"], :value 1.4112123648126922}]"}
;; <=

;; @@
(defn combine-observes-fn [observes]
  (map :value observes))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.dirichlet-process-mixture-stick-breaking/combine-observes-fn</span>","value":"#'worksheets.dirichlet-process-mixture-stick-breaking/combine-observes-fn"}
;; <=

;; @@
(def torch-connection (start-torch-connection dirichlet-process-mixture-stick-breaking [(repeat 8 nil)] combine-observes-fn))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.dirichlet-process-mixture-stick-breaking/torch-connection</span>","value":"#'worksheets.dirichlet-process-mixture-stick-breaking/torch-connection"}
;; <=

;; @@
(stop-torch-connection torch-connection)
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-string'>&quot;Torch connection terminated.&quot;</span>","value":"\"Torch connection terminated.\""}
;; <=

;; **
;;; ## Inference
;; **

;; @@
(def test-observations
  [-1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
   7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7 7
   3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3])

(def test-observations
  [0 0 0 0 12 12 12 12])
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;worksheets.dirichlet-process-mixture-stick-breaking/test-observations</span>","value":"#'worksheets.dirichlet-process-mixture-stick-breaking/test-observations"}
;; <=

;; **
;;; ### Infcomp
;;; 
;;; First, run the inference server from torch-infcomp:
;;; 
;;; `python -m infcomp.infer`
;;; 
;;; Then run the query, specifying number of particles:
;; **

;; @@
(def num-particles 100)
(def csis-states (take num-particles (infer :csis dirichlet-process-mixture-stick-breaking [test-observations])))
(plot/histogram (repeatedly 1000 #(sample* (categorical (vec (empirical-distribution (collect-results csis-states)))))) :normalize :probability-density :bins 100)
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"7b541753-575e-4066-8394-01e0d7f57a07","values":[{"x":-6.091766463363983,"y":0},{"x":-5.701772775884024,"y":0.01025657626882884},{"x":-5.311779088404064,"y":0.0},{"x":-4.921785400924104,"y":0.0},{"x":-4.531791713444145,"y":0.0},{"x":-4.141798025964185,"y":0.0},{"x":-3.751804338484226,"y":0.0},{"x":-3.3618106510042667,"y":0.0},{"x":-2.9718169635243075,"y":0.0},{"x":-2.5818232760443482,"y":0.0},{"x":-2.191829588564389,"y":0.0},{"x":-1.8018359010844298,"y":0.0},{"x":-1.4118422136044706,"y":0.0},{"x":-1.0218485261245114,"y":0.0},{"x":-0.6318548386445522,"y":0.0},{"x":-0.24186115116459295,"y":0.0},{"x":0.14813253631536627,"y":0.0},{"x":0.5381262237953255,"y":0.0},{"x":0.9281199112752847,"y":0.0},{"x":1.318113598755244,"y":0.0},{"x":1.7081072862352031,"y":0.0},{"x":2.0981009737151624,"y":0.0},{"x":2.4880946611951216,"y":0.7897563726998206},{"x":2.878088348675081,"y":0.0},{"x":3.26808203615504,"y":0.0},{"x":3.658075723634999,"y":0.0},{"x":4.048069411114959,"y":0.0},{"x":4.4380630985949185,"y":0.0},{"x":4.828056786074878,"y":0.02051315253765768},{"x":5.218050473554838,"y":0.0},{"x":5.6080441610347975,"y":0.0},{"x":5.998037848514757,"y":0.015384864403243258},{"x":6.388031535994717,"y":0.0},{"x":6.7780252234746765,"y":0.0},{"x":7.168018910954636,"y":0.0},{"x":7.558012598434596,"y":0.0},{"x":7.9480062859145555,"y":0.0},{"x":8.337999973394515,"y":1.2333532963266678},{"x":8.727993660874475,"y":0.0},{"x":9.117987348354434,"y":0.0},{"x":9.507981035834394,"y":0.0},{"x":9.897974723314354,"y":0.0},{"x":10.287968410794313,"y":0.0},{"x":10.677962098274273,"y":0.4230837710891896},{"x":11.067955785754233,"y":0.0},{"x":11.457949473234192,"y":0.0},{"x":11.847943160714152,"y":0.0},{"x":12.237936848194112,"y":0.0},{"x":12.627930535674071,"y":0.02051315253765768},{"x":13.017924223154031,"y":0.0},{"x":13.40791791063399,"y":0.0},{"x":13.79791159811395,"y":0.0},{"x":14.18790528559391,"y":0.0},{"x":14.57789897307387,"y":0.025641440672072097},{"x":14.96789266055383,"y":0.0},{"x":15.357886348033789,"y":0.0},{"x":15.747880035513749,"y":0.0},{"x":16.137873722993707,"y":0.0},{"x":16.527867410473664,"y":0.0},{"x":16.917861097953622,"y":0.0},{"x":17.30785478543358,"y":0.0},{"x":17.697848472913538,"y":0.0},{"x":18.087842160393496,"y":0.0},{"x":18.477835847873454,"y":0.0},{"x":18.867829535353412,"y":0.0},{"x":19.25782322283337,"y":0.0},{"x":19.647816910313328,"y":0.0},{"x":20.037810597793285,"y":0.0},{"x":20.427804285273243,"y":0.0},{"x":20.8177979727532,"y":0.0},{"x":21.20779166023316,"y":0.012820720336036049},{"x":21.597785347713117,"y":0.0},{"x":21.987779035193075,"y":0.0},{"x":22.377772722673033,"y":0.0},{"x":22.76776641015299,"y":0.0},{"x":23.15776009763295,"y":0.0},{"x":23.547753785112906,"y":0.0},{"x":23.937747472592864,"y":0.0},{"x":24.327741160072822,"y":0.0},{"x":24.71773484755278,"y":0.0},{"x":25.107728535032738,"y":0.0},{"x":25.497722222512696,"y":0.0},{"x":25.887715909992654,"y":0.0},{"x":26.27770959747261,"y":0.0},{"x":26.66770328495257,"y":0.0},{"x":27.057696972432527,"y":0.0},{"x":27.447690659912485,"y":0.0},{"x":27.837684347392443,"y":0.0},{"x":28.2276780348724,"y":0.0},{"x":28.61767172235236,"y":0.0},{"x":29.007665409832317,"y":0.0},{"x":29.397659097312275,"y":0.0},{"x":29.787652784792233,"y":0.0},{"x":30.17764647227219,"y":0.0},{"x":30.56764015975215,"y":0.0},{"x":30.957633847232106,"y":0.0},{"x":31.347627534712064,"y":0.0},{"x":31.737621222192022,"y":0.0},{"x":32.12761490967198,"y":0.0},{"x":32.51760859715194,"y":0.0},{"x":32.9076022846319,"y":0.0},{"x":33.29759597211186,"y":0.012820720336036049},{"x":33.687589659591815,"y":0}]}],"marks":[{"type":"line","from":{"data":"7b541753-575e-4066-8394-01e0d7f57a07"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"7b541753-575e-4066-8394-01e0d7f57a07","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"7b541753-575e-4066-8394-01e0d7f57a07","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"7b541753-575e-4066-8394-01e0d7f57a07\", :values ({:x -6.091766463363983, :y 0} {:x -5.701772775884024, :y 0.01025657626882884} {:x -5.311779088404064, :y 0.0} {:x -4.921785400924104, :y 0.0} {:x -4.531791713444145, :y 0.0} {:x -4.141798025964185, :y 0.0} {:x -3.751804338484226, :y 0.0} {:x -3.3618106510042667, :y 0.0} {:x -2.9718169635243075, :y 0.0} {:x -2.5818232760443482, :y 0.0} {:x -2.191829588564389, :y 0.0} {:x -1.8018359010844298, :y 0.0} {:x -1.4118422136044706, :y 0.0} {:x -1.0218485261245114, :y 0.0} {:x -0.6318548386445522, :y 0.0} {:x -0.24186115116459295, :y 0.0} {:x 0.14813253631536627, :y 0.0} {:x 0.5381262237953255, :y 0.0} {:x 0.9281199112752847, :y 0.0} {:x 1.318113598755244, :y 0.0} {:x 1.7081072862352031, :y 0.0} {:x 2.0981009737151624, :y 0.0} {:x 2.4880946611951216, :y 0.7897563726998206} {:x 2.878088348675081, :y 0.0} {:x 3.26808203615504, :y 0.0} {:x 3.658075723634999, :y 0.0} {:x 4.048069411114959, :y 0.0} {:x 4.4380630985949185, :y 0.0} {:x 4.828056786074878, :y 0.02051315253765768} {:x 5.218050473554838, :y 0.0} {:x 5.6080441610347975, :y 0.0} {:x 5.998037848514757, :y 0.015384864403243258} {:x 6.388031535994717, :y 0.0} {:x 6.7780252234746765, :y 0.0} {:x 7.168018910954636, :y 0.0} {:x 7.558012598434596, :y 0.0} {:x 7.9480062859145555, :y 0.0} {:x 8.337999973394515, :y 1.2333532963266678} {:x 8.727993660874475, :y 0.0} {:x 9.117987348354434, :y 0.0} {:x 9.507981035834394, :y 0.0} {:x 9.897974723314354, :y 0.0} {:x 10.287968410794313, :y 0.0} {:x 10.677962098274273, :y 0.4230837710891896} {:x 11.067955785754233, :y 0.0} {:x 11.457949473234192, :y 0.0} {:x 11.847943160714152, :y 0.0} {:x 12.237936848194112, :y 0.0} {:x 12.627930535674071, :y 0.02051315253765768} {:x 13.017924223154031, :y 0.0} {:x 13.40791791063399, :y 0.0} {:x 13.79791159811395, :y 0.0} {:x 14.18790528559391, :y 0.0} {:x 14.57789897307387, :y 0.025641440672072097} {:x 14.96789266055383, :y 0.0} {:x 15.357886348033789, :y 0.0} {:x 15.747880035513749, :y 0.0} {:x 16.137873722993707, :y 0.0} {:x 16.527867410473664, :y 0.0} {:x 16.917861097953622, :y 0.0} {:x 17.30785478543358, :y 0.0} {:x 17.697848472913538, :y 0.0} {:x 18.087842160393496, :y 0.0} {:x 18.477835847873454, :y 0.0} {:x 18.867829535353412, :y 0.0} {:x 19.25782322283337, :y 0.0} {:x 19.647816910313328, :y 0.0} {:x 20.037810597793285, :y 0.0} {:x 20.427804285273243, :y 0.0} {:x 20.8177979727532, :y 0.0} {:x 21.20779166023316, :y 0.012820720336036049} {:x 21.597785347713117, :y 0.0} {:x 21.987779035193075, :y 0.0} {:x 22.377772722673033, :y 0.0} {:x 22.76776641015299, :y 0.0} {:x 23.15776009763295, :y 0.0} {:x 23.547753785112906, :y 0.0} {:x 23.937747472592864, :y 0.0} {:x 24.327741160072822, :y 0.0} {:x 24.71773484755278, :y 0.0} {:x 25.107728535032738, :y 0.0} {:x 25.497722222512696, :y 0.0} {:x 25.887715909992654, :y 0.0} {:x 26.27770959747261, :y 0.0} {:x 26.66770328495257, :y 0.0} {:x 27.057696972432527, :y 0.0} {:x 27.447690659912485, :y 0.0} {:x 27.837684347392443, :y 0.0} {:x 28.2276780348724, :y 0.0} {:x 28.61767172235236, :y 0.0} {:x 29.007665409832317, :y 0.0} {:x 29.397659097312275, :y 0.0} {:x 29.787652784792233, :y 0.0} {:x 30.17764647227219, :y 0.0} {:x 30.56764015975215, :y 0.0} {:x 30.957633847232106, :y 0.0} {:x 31.347627534712064, :y 0.0} {:x 31.737621222192022, :y 0.0} {:x 32.12761490967198, :y 0.0} {:x 32.51760859715194, :y 0.0} {:x 32.9076022846319, :y 0.0} {:x 33.29759597211186, :y 0.012820720336036049} {:x 33.687589659591815, :y 0})}], :marks [{:type \"line\", :from {:data \"7b541753-575e-4066-8394-01e0d7f57a07\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"7b541753-575e-4066-8394-01e0d7f57a07\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"7b541753-575e-4066-8394-01e0d7f57a07\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; **
;;; ### IS
;; **

;; @@
(def num-particles 100)
(def is-states (take num-particles (infer :importance dirichlet-process-mixture-stick-breaking [test-observations])))
(plot/histogram (repeatedly 1000 #(sample* (categorical (vec (empirical-distribution (collect-results is-states)))))) :normalize :probability-density :bins 100)
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"c57ddb88-30b1-4616-9f5f-8fb2c4de139f","values":[{"x":-6.243251570872203,"y":0},{"x":-6.0927491641161104,"y":0.3388650128542585},{"x":-5.942246757360018,"y":0.0},{"x":-5.791744350603926,"y":0.0},{"x":-5.641241943847834,"y":0.0},{"x":-5.490739537091741,"y":0.0},{"x":-5.340237130335649,"y":0.0},{"x":-5.189734723579557,"y":0.0},{"x":-5.0392323168234645,"y":0.0},{"x":-4.888729910067372,"y":0.0},{"x":-4.73822750331128,"y":0.0},{"x":-4.587725096555188,"y":0.0},{"x":-4.437222689799095,"y":0.0},{"x":-4.286720283043003,"y":0.0},{"x":-4.136217876286911,"y":0.0},{"x":-3.9857154695308186,"y":0.0},{"x":-3.8352130627747263,"y":0.0},{"x":-3.684710656018634,"y":0.0},{"x":-3.5342082492625417,"y":0.0},{"x":-3.3837058425064495,"y":0.0},{"x":-3.233203435750357,"y":0.0},{"x":-3.082701028994265,"y":0.0},{"x":-2.9321986222381726,"y":0.0},{"x":-2.7816962154820803,"y":0.0},{"x":-2.631193808725988,"y":0.0},{"x":-2.480691401969896,"y":0.0},{"x":-2.3301889952138035,"y":0.0},{"x":-2.1796865884577112,"y":0.0},{"x":-2.029184181701619,"y":0.0},{"x":-1.878681774945527,"y":0.0},{"x":-1.7281793681894349,"y":0.0},{"x":-1.5776769614333428,"y":0.0},{"x":-1.4271745546772507,"y":0.0},{"x":-1.2766721479211587,"y":0.0},{"x":-1.1261697411650666,"y":0.0},{"x":-0.9756673344089746,"y":0.0},{"x":-0.8251649276528825,"y":0.006644412016750167},{"x":-0.6746625208967905,"y":0.0},{"x":-0.5241601141406984,"y":0.0},{"x":-0.3736577073846063,"y":0.0},{"x":-0.22315530062851419,"y":0.0},{"x":-0.07265289387242208,"y":0.0},{"x":0.07784951288367004,"y":0.0},{"x":0.22835191963976215,"y":0.0},{"x":0.37885432639585426,"y":0.0},{"x":0.5293567331519464,"y":0.0},{"x":0.6798591399080385,"y":0.0},{"x":0.8303615466641305,"y":0.0},{"x":0.9808639534202226,"y":0.0},{"x":1.1313663601763146,"y":0.0},{"x":1.2818687669324067,"y":0.0},{"x":1.4323711736884988,"y":0.0},{"x":1.5828735804445908,"y":0.0},{"x":1.7333759872006829,"y":0.0},{"x":1.883878393956775,"y":0.0},{"x":2.034380800712867,"y":0.0},{"x":2.1848832074689595,"y":0.0},{"x":2.3353856142250518,"y":0.0},{"x":2.485888020981144,"y":0.0},{"x":2.6363904277372363,"y":0.0},{"x":2.7868928344933286,"y":0.0},{"x":2.937395241249421,"y":0.0},{"x":3.087897648005513,"y":0.0},{"x":3.2384000547616054,"y":0.0},{"x":3.3889024615176977,"y":0.0},{"x":3.53940486827379,"y":0.0},{"x":3.6899072750298822,"y":0.0},{"x":3.8404096817859745,"y":0.0},{"x":3.990912088542067,"y":0.0},{"x":4.141414495298159,"y":0.0199332360502505},{"x":4.291916902054251,"y":0.0},{"x":4.442419308810344,"y":0.0},{"x":4.592921715566436,"y":0.039866472100501},{"x":4.743424122322528,"y":0.0},{"x":4.8939265290786205,"y":0.0},{"x":5.044428935834713,"y":0.0},{"x":5.194931342590805,"y":0.0},{"x":5.345433749346897,"y":0.0},{"x":5.49593615610299,"y":0.0},{"x":5.646438562859082,"y":0.006644412016750167},{"x":5.796940969615174,"y":0.0},{"x":5.947443376371266,"y":0.0},{"x":6.097945783127359,"y":0.0},{"x":6.248448189883451,"y":0.0},{"x":6.398950596639543,"y":0.0},{"x":6.5494530033956355,"y":0.0},{"x":6.699955410151728,"y":0.6312191415912659},{"x":6.85045781690782,"y":0.0},{"x":7.000960223663912,"y":0.0},{"x":7.151462630420005,"y":0.0},{"x":7.301965037176097,"y":0.0},{"x":7.452467443932189,"y":0.0},{"x":7.6029698506882815,"y":0.0},{"x":7.753472257444374,"y":0.0},{"x":7.903974664200466,"y":0.0},{"x":8.054477070956558,"y":0.0},{"x":8.20497947771265,"y":0.0},{"x":8.355481884468741,"y":0.0},{"x":8.505984291224832,"y":2.305610969812308},{"x":8.656486697980924,"y":0.0},{"x":8.806989104737015,"y":3.295628360308083},{"x":8.957491511493107,"y":0}]}],"marks":[{"type":"line","from":{"data":"c57ddb88-30b1-4616-9f5f-8fb2c4de139f"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"c57ddb88-30b1-4616-9f5f-8fb2c4de139f","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"c57ddb88-30b1-4616-9f5f-8fb2c4de139f","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"c57ddb88-30b1-4616-9f5f-8fb2c4de139f\", :values ({:x -6.243251570872203, :y 0} {:x -6.0927491641161104, :y 0.3388650128542585} {:x -5.942246757360018, :y 0.0} {:x -5.791744350603926, :y 0.0} {:x -5.641241943847834, :y 0.0} {:x -5.490739537091741, :y 0.0} {:x -5.340237130335649, :y 0.0} {:x -5.189734723579557, :y 0.0} {:x -5.0392323168234645, :y 0.0} {:x -4.888729910067372, :y 0.0} {:x -4.73822750331128, :y 0.0} {:x -4.587725096555188, :y 0.0} {:x -4.437222689799095, :y 0.0} {:x -4.286720283043003, :y 0.0} {:x -4.136217876286911, :y 0.0} {:x -3.9857154695308186, :y 0.0} {:x -3.8352130627747263, :y 0.0} {:x -3.684710656018634, :y 0.0} {:x -3.5342082492625417, :y 0.0} {:x -3.3837058425064495, :y 0.0} {:x -3.233203435750357, :y 0.0} {:x -3.082701028994265, :y 0.0} {:x -2.9321986222381726, :y 0.0} {:x -2.7816962154820803, :y 0.0} {:x -2.631193808725988, :y 0.0} {:x -2.480691401969896, :y 0.0} {:x -2.3301889952138035, :y 0.0} {:x -2.1796865884577112, :y 0.0} {:x -2.029184181701619, :y 0.0} {:x -1.878681774945527, :y 0.0} {:x -1.7281793681894349, :y 0.0} {:x -1.5776769614333428, :y 0.0} {:x -1.4271745546772507, :y 0.0} {:x -1.2766721479211587, :y 0.0} {:x -1.1261697411650666, :y 0.0} {:x -0.9756673344089746, :y 0.0} {:x -0.8251649276528825, :y 0.006644412016750167} {:x -0.6746625208967905, :y 0.0} {:x -0.5241601141406984, :y 0.0} {:x -0.3736577073846063, :y 0.0} {:x -0.22315530062851419, :y 0.0} {:x -0.07265289387242208, :y 0.0} {:x 0.07784951288367004, :y 0.0} {:x 0.22835191963976215, :y 0.0} {:x 0.37885432639585426, :y 0.0} {:x 0.5293567331519464, :y 0.0} {:x 0.6798591399080385, :y 0.0} {:x 0.8303615466641305, :y 0.0} {:x 0.9808639534202226, :y 0.0} {:x 1.1313663601763146, :y 0.0} {:x 1.2818687669324067, :y 0.0} {:x 1.4323711736884988, :y 0.0} {:x 1.5828735804445908, :y 0.0} {:x 1.7333759872006829, :y 0.0} {:x 1.883878393956775, :y 0.0} {:x 2.034380800712867, :y 0.0} {:x 2.1848832074689595, :y 0.0} {:x 2.3353856142250518, :y 0.0} {:x 2.485888020981144, :y 0.0} {:x 2.6363904277372363, :y 0.0} {:x 2.7868928344933286, :y 0.0} {:x 2.937395241249421, :y 0.0} {:x 3.087897648005513, :y 0.0} {:x 3.2384000547616054, :y 0.0} {:x 3.3889024615176977, :y 0.0} {:x 3.53940486827379, :y 0.0} {:x 3.6899072750298822, :y 0.0} {:x 3.8404096817859745, :y 0.0} {:x 3.990912088542067, :y 0.0} {:x 4.141414495298159, :y 0.0199332360502505} {:x 4.291916902054251, :y 0.0} {:x 4.442419308810344, :y 0.0} {:x 4.592921715566436, :y 0.039866472100501} {:x 4.743424122322528, :y 0.0} {:x 4.8939265290786205, :y 0.0} {:x 5.044428935834713, :y 0.0} {:x 5.194931342590805, :y 0.0} {:x 5.345433749346897, :y 0.0} {:x 5.49593615610299, :y 0.0} {:x 5.646438562859082, :y 0.006644412016750167} {:x 5.796940969615174, :y 0.0} {:x 5.947443376371266, :y 0.0} {:x 6.097945783127359, :y 0.0} {:x 6.248448189883451, :y 0.0} {:x 6.398950596639543, :y 0.0} {:x 6.5494530033956355, :y 0.0} {:x 6.699955410151728, :y 0.6312191415912659} {:x 6.85045781690782, :y 0.0} {:x 7.000960223663912, :y 0.0} {:x 7.151462630420005, :y 0.0} {:x 7.301965037176097, :y 0.0} {:x 7.452467443932189, :y 0.0} {:x 7.6029698506882815, :y 0.0} {:x 7.753472257444374, :y 0.0} {:x 7.903974664200466, :y 0.0} {:x 8.054477070956558, :y 0.0} {:x 8.20497947771265, :y 0.0} {:x 8.355481884468741, :y 0.0} {:x 8.505984291224832, :y 2.305610969812308} {:x 8.656486697980924, :y 0.0} {:x 8.806989104737015, :y 3.295628360308083} {:x 8.957491511493107, :y 0})}], :marks [{:type \"line\", :from {:data \"c57ddb88-30b1-4616-9f5f-8fb2c4de139f\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"c57ddb88-30b1-4616-9f5f-8fb2c4de139f\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"c57ddb88-30b1-4616-9f5f-8fb2c4de139f\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; **
;;; ### SMC
;; **

;; @@
(def num-particles 100)
(def smc-states (take num-particles (infer :smc dirichlet-process-mixture-stick-breaking [test-observations] :number-of-particles 100)))
(plot/histogram (repeatedly 1000 #(sample* (categorical (vec (empirical-distribution (collect-results smc-states)))))) :normalize :probability-density :bins 100)
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"top":10,"left":55,"bottom":40,"right":10},"data":[{"name":"51e28dda-de88-4071-987a-80ae67781ab5","values":[{"x":-18.236384407653375,"y":0},{"x":-17.64083864063221,"y":0.021828716985134774},{"x":-17.045292873611047,"y":0.0},{"x":-16.449747106589882,"y":0.02350784906091437},{"x":-15.854201339568718,"y":0.0},{"x":-15.258655572547553,"y":0.0},{"x":-14.663109805526389,"y":0.0},{"x":-14.067564038505225,"y":0.0},{"x":-13.47201827148406,"y":0.015112188682016383},{"x":-12.876472504462896,"y":0.0},{"x":-12.280926737441732,"y":0.015112188682016383},{"x":-11.685380970420567,"y":0.0},{"x":-11.089835203399403,"y":0.0},{"x":-10.494289436378239,"y":0.0},{"x":-9.898743669357074,"y":0.0},{"x":-9.30319790233591,"y":0.058769622652285934},{"x":-8.707652135314746,"y":0.0},{"x":-8.112106368293581,"y":0.01847045283357558},{"x":-7.516560601272417,"y":0.0},{"x":-6.9210148342512525,"y":0.0},{"x":-6.325469067230088,"y":0.0},{"x":-5.729923300208924,"y":0.015112188682016383},{"x":-5.1343775331877595,"y":0.04197830189448995},{"x":-4.538831766166595,"y":0.026866113212473567},{"x":-3.943285999145431,"y":0.0},{"x":-3.3477402321242673,"y":0.01847045283357558},{"x":-2.7521944651031034,"y":0.09067313209209829},{"x":-2.1566486980819395,"y":0.03694090566715116},{"x":-1.5611029310607756,"y":0.038620037742930755},{"x":-0.9655571640396116,"y":0.026866113212473567},{"x":-0.37001139701844754,"y":0.02518698113669397},{"x":0.22553437000271648,"y":0.06884441510696351},{"x":0.8210801370238805,"y":0.0805983396374207},{"x":1.4166259040450444,"y":0.07220267925852271},{"x":2.0121716710662083,"y":0.045336566046049145},{"x":2.607717438087372,"y":0.01847045283357558},{"x":3.203263205108536,"y":0.04701569812182874},{"x":3.7988089721297,"y":0.04029916981871035},{"x":4.394354739150864,"y":0.04869483019760834},{"x":4.989900506172028,"y":0.04365743397026955},{"x":5.585446273193193,"y":0.04197830189448995},{"x":6.180992040214357,"y":0.10914358492567387},{"x":6.776537807235521,"y":0.013433056606236784},{"x":7.372083574256686,"y":0.01847045283357558},{"x":7.96762934127785,"y":0.05541135850072673},{"x":8.563175108299014,"y":0.031903509439812364},{"x":9.158720875320178,"y":0.02518698113669397},{"x":9.754266642341342,"y":0.0},{"x":10.349812409362507,"y":0.04365743397026955},{"x":10.945358176383671,"y":0.03526177359137156},{"x":11.540903943404835,"y":0.06212788680384513},{"x":12.136449710426,"y":0.0},{"x":12.731995477447164,"y":0.04365743397026955},{"x":13.327541244468328,"y":0.013433056606236784},{"x":13.923087011489493,"y":0.0},{"x":14.518632778510657,"y":0.0},{"x":15.114178545531821,"y":0.01847045283357558},{"x":15.709724312552986,"y":0.021828716985134774},{"x":16.30527007957415,"y":0.05541135850072673},{"x":16.900815846595314,"y":0.020149584909355176},{"x":17.49636161361648,"y":0.0},{"x":18.091907380637643,"y":0.0},{"x":18.687453147658807,"y":0.02518698113669397},{"x":19.282998914679972,"y":0.0},{"x":19.878544681701136,"y":0.0},{"x":20.4740904487223,"y":0.0},{"x":21.069636215743465,"y":0.0},{"x":21.66518198276463,"y":0.021828716985134774},{"x":22.260727749785794,"y":0.02350784906091437},{"x":22.856273516806958,"y":0.0},{"x":23.451819283828122,"y":0.0},{"x":24.047365050849287,"y":0.0},{"x":24.64291081787045,"y":0.0},{"x":25.238456584891615,"y":0.0},{"x":25.83400235191278,"y":0.0},{"x":26.429548118933944,"y":0.0},{"x":27.02509388595511,"y":0.01847045283357558},{"x":27.620639652976273,"y":0.0},{"x":28.216185419997437,"y":0.0},{"x":28.8117311870186,"y":0.030224377364032766},{"x":29.407276954039766,"y":0.0},{"x":30.00282272106093,"y":0.0},{"x":30.598368488082095,"y":0.0},{"x":31.19391425510326,"y":0.0},{"x":31.789460022124423,"y":0.0},{"x":32.38500578914559,"y":0.0},{"x":32.98055155616675,"y":0.0},{"x":33.576097323187916,"y":0.0},{"x":34.17164309020908,"y":0.0},{"x":34.767188857230245,"y":0.0},{"x":35.36273462425141,"y":0.0},{"x":35.958280391272574,"y":0.0},{"x":36.55382615829374,"y":0.0},{"x":37.1493719253149,"y":0.0},{"x":37.74491769233607,"y":0.0},{"x":38.34046345935723,"y":0.0},{"x":38.936009226378395,"y":0.0},{"x":39.53155499339956,"y":0.0},{"x":40.127100760420724,"y":0.0},{"x":40.72264652744189,"y":0.0},{"x":41.31819229446305,"y":0.011753924530457186},{"x":41.91373806148422,"y":0}]}],"marks":[{"type":"line","from":{"data":"51e28dda-de88-4071-987a-80ae67781ab5"},"properties":{"enter":{"x":{"scale":"x","field":"data.x"},"y":{"scale":"y","field":"data.y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}],"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"51e28dda-de88-4071-987a-80ae67781ab5","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"51e28dda-de88-4071-987a-80ae67781ab5","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:top 10, :left 55, :bottom 40, :right 10}, :data [{:name \"51e28dda-de88-4071-987a-80ae67781ab5\", :values ({:x -18.236384407653375, :y 0} {:x -17.64083864063221, :y 0.021828716985134774} {:x -17.045292873611047, :y 0.0} {:x -16.449747106589882, :y 0.02350784906091437} {:x -15.854201339568718, :y 0.0} {:x -15.258655572547553, :y 0.0} {:x -14.663109805526389, :y 0.0} {:x -14.067564038505225, :y 0.0} {:x -13.47201827148406, :y 0.015112188682016383} {:x -12.876472504462896, :y 0.0} {:x -12.280926737441732, :y 0.015112188682016383} {:x -11.685380970420567, :y 0.0} {:x -11.089835203399403, :y 0.0} {:x -10.494289436378239, :y 0.0} {:x -9.898743669357074, :y 0.0} {:x -9.30319790233591, :y 0.058769622652285934} {:x -8.707652135314746, :y 0.0} {:x -8.112106368293581, :y 0.01847045283357558} {:x -7.516560601272417, :y 0.0} {:x -6.9210148342512525, :y 0.0} {:x -6.325469067230088, :y 0.0} {:x -5.729923300208924, :y 0.015112188682016383} {:x -5.1343775331877595, :y 0.04197830189448995} {:x -4.538831766166595, :y 0.026866113212473567} {:x -3.943285999145431, :y 0.0} {:x -3.3477402321242673, :y 0.01847045283357558} {:x -2.7521944651031034, :y 0.09067313209209829} {:x -2.1566486980819395, :y 0.03694090566715116} {:x -1.5611029310607756, :y 0.038620037742930755} {:x -0.9655571640396116, :y 0.026866113212473567} {:x -0.37001139701844754, :y 0.02518698113669397} {:x 0.22553437000271648, :y 0.06884441510696351} {:x 0.8210801370238805, :y 0.0805983396374207} {:x 1.4166259040450444, :y 0.07220267925852271} {:x 2.0121716710662083, :y 0.045336566046049145} {:x 2.607717438087372, :y 0.01847045283357558} {:x 3.203263205108536, :y 0.04701569812182874} {:x 3.7988089721297, :y 0.04029916981871035} {:x 4.394354739150864, :y 0.04869483019760834} {:x 4.989900506172028, :y 0.04365743397026955} {:x 5.585446273193193, :y 0.04197830189448995} {:x 6.180992040214357, :y 0.10914358492567387} {:x 6.776537807235521, :y 0.013433056606236784} {:x 7.372083574256686, :y 0.01847045283357558} {:x 7.96762934127785, :y 0.05541135850072673} {:x 8.563175108299014, :y 0.031903509439812364} {:x 9.158720875320178, :y 0.02518698113669397} {:x 9.754266642341342, :y 0.0} {:x 10.349812409362507, :y 0.04365743397026955} {:x 10.945358176383671, :y 0.03526177359137156} {:x 11.540903943404835, :y 0.06212788680384513} {:x 12.136449710426, :y 0.0} {:x 12.731995477447164, :y 0.04365743397026955} {:x 13.327541244468328, :y 0.013433056606236784} {:x 13.923087011489493, :y 0.0} {:x 14.518632778510657, :y 0.0} {:x 15.114178545531821, :y 0.01847045283357558} {:x 15.709724312552986, :y 0.021828716985134774} {:x 16.30527007957415, :y 0.05541135850072673} {:x 16.900815846595314, :y 0.020149584909355176} {:x 17.49636161361648, :y 0.0} {:x 18.091907380637643, :y 0.0} {:x 18.687453147658807, :y 0.02518698113669397} {:x 19.282998914679972, :y 0.0} {:x 19.878544681701136, :y 0.0} {:x 20.4740904487223, :y 0.0} {:x 21.069636215743465, :y 0.0} {:x 21.66518198276463, :y 0.021828716985134774} {:x 22.260727749785794, :y 0.02350784906091437} {:x 22.856273516806958, :y 0.0} {:x 23.451819283828122, :y 0.0} {:x 24.047365050849287, :y 0.0} {:x 24.64291081787045, :y 0.0} {:x 25.238456584891615, :y 0.0} {:x 25.83400235191278, :y 0.0} {:x 26.429548118933944, :y 0.0} {:x 27.02509388595511, :y 0.01847045283357558} {:x 27.620639652976273, :y 0.0} {:x 28.216185419997437, :y 0.0} {:x 28.8117311870186, :y 0.030224377364032766} {:x 29.407276954039766, :y 0.0} {:x 30.00282272106093, :y 0.0} {:x 30.598368488082095, :y 0.0} {:x 31.19391425510326, :y 0.0} {:x 31.789460022124423, :y 0.0} {:x 32.38500578914559, :y 0.0} {:x 32.98055155616675, :y 0.0} {:x 33.576097323187916, :y 0.0} {:x 34.17164309020908, :y 0.0} {:x 34.767188857230245, :y 0.0} {:x 35.36273462425141, :y 0.0} {:x 35.958280391272574, :y 0.0} {:x 36.55382615829374, :y 0.0} {:x 37.1493719253149, :y 0.0} {:x 37.74491769233607, :y 0.0} {:x 38.34046345935723, :y 0.0} {:x 38.936009226378395, :y 0.0} {:x 39.53155499339956, :y 0.0} {:x 40.127100760420724, :y 0.0} {:x 40.72264652744189, :y 0.0} {:x 41.31819229446305, :y 0.011753924530457186} {:x 41.91373806148422, :y 0})}], :marks [{:type \"line\", :from {:data \"51e28dda-de88-4071-987a-80ae67781ab5\"}, :properties {:enter {:x {:scale \"x\", :field \"data.x\"}, :y {:scale \"y\", :field \"data.y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}}], :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"51e28dda-de88-4071-987a-80ae67781ab5\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"51e28dda-de88-4071-987a-80ae67781ab5\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}]}}"}
;; <=

;; @@

;; @@
